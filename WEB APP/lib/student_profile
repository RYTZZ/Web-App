<?php
session_start();
require_once 'db.php';
require_once 'config.php';
if (!isset($_SESSION['user_type']) || $_SESSION['user_type'] !== 'student') { header('Location: index.php'); exit; }

$conn = db_connect();
$uid = intval($_SESSION['user_id']);
$stmt = $conn->prepare('SELECT * FROM students WHERE id = ? LIMIT 1');
$stmt->bind_param('i', $uid);
$stmt->execute();
$student = $stmt->get_result()->fetch_assoc();
?>
<!doctype html><html><head><meta charset="utf-8"><title>Profile - <?php echo SITE_NAME;?></title>
<link rel="stylesheet" href="assets/css/style.css"></head><body>
<div class="container">
<h1>Welcome, <?php echo htmlspecialchars($student['name']); ?></h1>
<p>Student ID: <?php echo htmlspecialchars($student['student_id']); ?></p>
<p>Course: <?php echo htmlspecialchars($student['course']); ?> | Block: <?php echo htmlspecialchars($student['block']); ?></p>
<p>Your QR: <a href="qr.php?token=<?php echo urlencode($student['qr_token']);?>" target="_blank">Open QR</a></p>
<?php if ($student['must_change_password']): ?>
  <p style="color:red;">Your default password is your Student ID. Please <a href="change_password.php">change it now</a>.</p>
<?php endif; ?>
<p><a href="change_password.php">Change password</a> | <a href="logout.php">Logout</a></p>
</div></body></html>
